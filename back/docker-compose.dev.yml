version: '3.8'

# ============================================
# Docker Compose para DESARROLLO
# ============================================
# Usar con: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  app:
    # Sobrescribir comando para desarrollo con hot reload
    command: >
      sh -c "
        echo 'â³ Esperando a que PostgreSQL estÃ© listo...' &&
        until pg_isready -h postgres -p 5432 -U $${POSTGRES_USER:-postgres}; do
          echo 'PostgreSQL no estÃ¡ listo, esperando...'
          sleep 2
        done &&
        echo 'âœ… PostgreSQL listo' &&
        echo 'â³ Esperando a que Redis estÃ© listo...' &&
        until redis-cli -h redis ping > /dev/null 2>&1; do
          echo 'Redis no estÃ¡ listo, esperando...'
          sleep 2
        done &&
        echo 'âœ… Redis listo' &&
        echo 'ðŸš€ Iniciando PlantCare Backend en modo desarrollo (hot reload)...' &&
        uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload --reload-dir /app/app
      "
    volumes:
      # Montar cÃ³digo con write para hot reload
      - ./app:/app/app:rw
      - api_data:/app/data
      - uploads_data:/app/uploads
      - logs_data:/app/logs
    environment:
      - RELOAD=true
      - DEBUG=true
