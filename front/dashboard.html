<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PlantCare - Dashboard</title>
  <link rel="stylesheet" href="./assets/css/dashboard.css">
  <link rel="stylesheet" href="./jsdash.js">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">PC</div>
        <div>
          <h1>PlantCare</h1>
          <p>Dashboard - Datos Reales</p>
        </div>
      </div>

      <!-- Server connection status -->
      <div id="connectionStatus" class="connection-status disconnected">
        <div class="loading"></div>
        <span>Conectando...</span>
      </div>

      <nav>
        <a class="menu active" href="#"><span class="dot"></span> Overview</a>
        <a class="menu" href="#"><span class="status-indicator status-online"></span> Humedad</a>
        <a class="menu" href="#"><span class="status-indicator status-warning"></span> Temperatura</a>
        <a class="menu" href="#"><span class="status-indicator status-online"></span> PresiÃ³n</a>
        <a class="menu" href="#">ğŸ“Š HistÃ³rico</a>
        <a class="menu" href="#">âš™ï¸ ConfiguraciÃ³n</a>
      </nav>

      <!-- Server Configuration -->
      <div class="config-panel">
        <div class="section-title">Servidor</div>
        <input type="text" id="serverUrl" placeholder="http://192.168.103.12:5000" />
        <button onclick="connectToServer()">Conectar</button>
      </div>

      <div class="section-title">Sensores detectados</div>
      <div id="sensorsContainer" style="display:flex;flex-direction:column;gap:8px">
        <div class="chip">ğŸ” Buscando sensores...</div>
      </div>

      <div class="theme-toggle">
        <span>Tema</span>
        <div class="toggle-switch" onclick="toggleTheme()"></div>
      </div>

      <div style="flex:1"></div>
      <div class="muted" style="font-size:12px">VersiÃ³n Real-Time Â· PlantCare 2025</div>
    </aside>

    <main class="main">
      <header class="header">
        <div style="display:flex;gap:12px;align-items:center;flex:1">
          <div class="search">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
              <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="1.6"/>
            </svg>
            <input placeholder="Buscar en datos de sensores..." />
          </div>

          <div class="chip" id="lastUpdateTime">ğŸ“… Nunca actualizado</div>
          <div class="chip" id="dataCount">ğŸ”¢ 0 registros</div>
        </div>

        <div class="user">
          <div style="text-align:right">
            <div style="font-size:13px;font-weight:700">BastiÃ¡n</div>
            <div class="muted" style="font-size:12px">Administrador</div>
          </div>
          <div class="avatar">BE</div>
        </div>
      </header>

      <section class="content">
        <div style="min-height:0;overflow:auto;padding-right:6px">

          <!-- Real-time KPI Cards -->
          <div class="grid" style="margin-bottom:14px">
            <div class="card">
              <div>
                <div class="title">Humedad actual</div>
                <div class="value" id="currentHumidity" style="color: var(--accent-2)">--</div>
              </div>
              <div class="small">
                <span class="status-indicator status-online"></span>
                <span id="humidityStatus">Cargando...</span>
              </div>
            </div>

            <div class="card">
              <div>
                <div class="title">Temperatura</div>
                <div class="value" id="currentTemperature" style="color: var(--accent)">--</div>
              </div>
              <div class="small" id="temperatureStatus">Sensor BMP180</div>
            </div>

            <div class="card">
              <div>
                <div class="title">PresiÃ³n atmosfÃ©rica</div>
                <div class="value" id="currentPressure" style="color: var(--warning)">--</div>
              </div>
              <div class="small" id="pressureStatus">hPa</div>
            </div>
          </div>

          <!-- Charts Panel -->
          <div class="panel" style="margin-bottom:14px">
            <h3>ğŸ“Š Datos en tiempo real</h3>
            <div class="chart-container">
              <svg id="realTimeChart" viewBox="0 0 600 120" preserveAspectRatio="none" style="width:100%;height:120px">
                <defs>
                  <linearGradient id="chartGradient" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="#16a34a" stop-opacity="0.3" />
                    <stop offset="100%" stop-color="#16a34a" stop-opacity="0" />
                  </linearGradient>
                </defs>
                <text x="300" y="60" text-anchor="middle" fill="var(--muted)" font-size="14">
                  Esperando datos del servidor...
                </text>
              </svg>
            </div>
            
            <div style="display:flex;gap:12px;margin-top:12px;font-size:12px">
              <div style="display:flex;align-items:center;gap:6px">
                <div style="width:12px;height:3px;background:var(--accent);border-radius:2px"></div>
                <span class="muted">Humedad del suelo</span>
              </div>
              <div style="display:flex;align-items:center;gap:6px">
                <div style="width:12px;height:3px;background:var(--accent-2);border-radius:2px"></div>
                <span class="muted">Temperatura</span>
              </div>
              <div style="display:flex;align-items:center;gap:6px">
                <div style="width:12px;height:3px;background:var(--warning);border-radius:2px"></div>
                <span class="muted">PresiÃ³n</span>
              </div>
            </div>
          </div>

          <!-- Statistics Panel -->
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px">
            <div class="panel">
              <h3>ğŸ“ˆ EstadÃ­sticas del servidor</h3>
              <div id="statisticsContainer">
                <div class="text-center muted">
                  <div class="loading" style="margin:0 auto 8px"></div>
                  Cargando estadÃ­sticas...
                </div>
              </div>
            </div>

            <div class="panel">
              <h3>ğŸš¨ Estado del sistema</h3>
              <div id="systemStatus">
                <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                  <span class="muted">Servidor</span>
                  <span id="serverStatus">ğŸ” Verificando...</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                  <span class="muted">Base de datos</span>
                  <span id="dbStatus">â³ Conectando...</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                  <span class="muted">Ãšltima lectura</span>
                  <span id="lastReading">â“ Desconocido</span>
                </div>
                <div style="display:flex;justify-content:space-between">
                  <span class="muted">Sensores activos</span>
                  <span id="activeSensors">0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Data Table -->
          <div class="panel">
            <h3>ğŸ“‹ Lecturas recientes</h3>
            <div id="recentDataContainer" style="overflow:auto">
              <div class="text-center muted">
                <div class="loading" style="margin:0 auto 8px"></div>
                Cargando datos recientes...
              </div>
            </div>
          </div>

        </div>

        <!-- Right Sidebar -->
        <aside style="min-height:0;overflow:auto">
          <div class="panel" style="margin-bottom:12px">
            <h3>ğŸ“Š Resumen en vivo</h3>
            <div id="liveSummary">
              <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                <div class="muted">ğŸ”Œ Total registros</div>
                <div id="totalRecords" style="font-weight:600">0</div>
              </div>
              <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                <div class="muted">ğŸ’§ Humedad promedio</div>
                <div id="avgHumidity" style="font-weight:600">--%</div>
              </div>
              <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                <div class="muted">ğŸŒ¡ï¸ Temp. promedio</div>
                <div id="avgTemperature" style="font-weight:600">--Â°C</div>
              </div>
              <div style="display:flex;justify-content:space-between">
                <div class="muted">ğŸ”½ PresiÃ³n promedio</div>
                <div id="avgPressure" style="font-weight:600">-- hPa</div>
              </div>
            </div>
          </div>

          <div class="panel" style="margin-bottom:12px">
            <h3>âš™ï¸ ConfiguraciÃ³n</h3>
            <div style="display:flex;flex-direction:column;gap:8px">
              <div>
                <label class="small">Intervalo de actualizaciÃ³n</label>
                <select id="updateInterval" style="width:100%;background:var(--glass);border:1px solid var(--border);border-radius:6px;padding:6px;color:var(--text)">
                  <option value="5000">5 segundos</option>
                  <option value="10000">10 segundos</option>
                  <option value="30000">30 segundos</option>
                  <option value="60000">1 minuto</option>
                </select>
              </div>
              <div style="display:flex;align-items:center;justify-content:space-between">
                <span class="small">Auto-actualizar</span>
                <div class="toggle-switch" style="width:36px;height:18px" onclick="toggleAutoUpdate()">
                  <div id="autoUpdateToggle" style="width:14px;height:14px;transform:translateX(18px)"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel">
            <h3>âš¡ Acciones</h3>
            <div style="display:flex;flex-direction:column;gap:8px">
              <button class="btn-primary" onclick="manualRefresh()">ğŸ”„ Actualizar ahora</button>
              <button class="btn-secondary" onclick="exportData()">ğŸ’¾ Exportar datos</button>
              <button class="btn-secondary" onclick="clearData()">ğŸ—‘ï¸ Limpiar vista</button>
              <button class="btn-secondary" onclick="testConnection()">ğŸ§ª Test conexiÃ³n</button>
            </div>
          </div>
        </aside>
      </section>
      <div class="footer">Â© PlantCare Â· Real-Time Dashboard Â· 2025 - Multi-Sensor v2.0</div>
    </main>
  </div>
</body>
</html>